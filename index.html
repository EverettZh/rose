# Create a share-ready HTML that autostarts inside in-app browsers (WeChat, Instagram) and
# gracefully restarts on visibility changes / taps. Includes Open Graph meta for nice previews.
html = r"""<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Rose Drawer</title>

  <!-- Social preview (Instagram/WeChat will show page title; OG helps for other platforms) -->
  <meta property="og:title" content="Drawing a Rose ðŸŒ¹" />
  <meta property="og:description" content="Tap to watch a rose draw itself. Works inside WeChat/Instagram." />
  <meta name="theme-color" content="#0b0d10">

  <style>
    html, body { margin:0; height:100%; background:#0b0d10; color:#fff; font-family: -apple-system, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    #c { width:100vw; height:100vh; display:block; touch-action:manipulation; }
    .hud { position:fixed; top:12px; left:12px; background:rgba(0,0,0,.35); padding:8px 10px; border-radius:10px; font-size:14px; }
    .hint { position:fixed; bottom:14px; left:50%; transform:translateX(-50%); opacity:.8; font-size:13px; }
    .btn { padding:6px 10px; border-radius:8px; background:#1e293b; border:1px solid rgba(255,255,255,.12); margin-left:6px; }
  </style>
</head>
<body>
<canvas id="c"></canvas>
<div class="hud">ðŸŒ¹ Rose is drawingâ€¦ <span id="pct">0%</span>
  <button id="restart" class="btn" aria-label="Restart">â†»</button>
</div>
<div class="hint">Tap anywhere to restart â€¢ Share this link in WeChat/Instagram</div>
<script>
(() => {
  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d", { alpha: false });
  const pctEl = document.getElementById("pct");
  const restartBtn = document.getElementById("restart");

  // Device pixel ratio capping for performance inside webviews
  const DPR = Math.max(1, Math.min(2.5, window.devicePixelRatio || 1));

  function resize() {
    const w = Math.floor(window.innerWidth * DPR);
    const h = Math.floor(window.innerHeight * DPR);
    canvas.width = w; canvas.height = h;
    canvas.style.width = window.innerWidth + "px";
    canvas.style.height = window.innerHeight + "px";
  }
  window.addEventListener("resize", () => { resize(); drawFrame(0,true); });
  resize();

  // Parameters (URL overrides allowed)
  let k = 7, a = 0.42, speed = 1.0;
  try {
    const q = new URLSearchParams(location.search);
    if (q.has("k")) k = Math.max(1, parseInt(q.get("k"), 10) || 7);
    if (q.has("a")) a = Math.min(0.49, Math.max(0.1, parseFloat(q.get("a")) || a));
    if (q.has("speed")) speed = Math.min(4, Math.max(0.2, parseFloat(q.get("speed")) || speed));
  } catch {}

  let t0 = 0, animId = 0, running = false;

  function drawFrame(elapsed, clearAll=false) {
    const w = canvas.width, h = canvas.height;
    const dim = Math.min(w, h);
    const R = dim * a;

    if (clearAll) ctx.clearRect(0,0,w,h);
    ctx.fillStyle = "#0b0d10"; ctx.fillRect(0,0,w,h);

    const cx = w/2, cy = h/2;

    // vignette
    const g = ctx.createRadialGradient(cx, cy, R*0.2, cx, cy, R*1.6);
    g.addColorStop(0, "rgba(255,255,255,0.02)");
    g.addColorStop(1, "rgba(0,0,0,0.65)");
    ctx.fillStyle = g; ctx.fillRect(0,0,w,h);

    // progress 0..1
    const dur = 8000 / speed;
    const p = Math.min(1, elapsed / dur);
    pctEl.textContent = Math.round(p*100) + "%";

    // draw progressive stroke
    ctx.save();
    ctx.translate(cx, cy);
    ctx.lineCap = "round"; ctx.lineJoin = "round";

    // trail
    ctx.strokeStyle = "rgba(220, 38, 38, .18)";
    ctx.lineWidth = Math.max(1, 6 * DPR);
    ctx.beginPath();
    for (let i=0;i<=Math.floor(2500*p);i++){
      const theta = 2*Math.PI*i/2500;
      const r = R * Math.cos(k*theta);
      const x = r * Math.cos(theta);
      const y = r * Math.sin(theta);
      if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
    ctx.stroke();

    // bright tip
    if (p>0){
      const i = Math.floor(2500*p);
      const theta = 2*Math.PI*i/2500;
      const r = R * Math.cos(k*theta);
      const x = r * Math.cos(theta);
      const y = r * Math.sin(theta);
      const tip = ctx.createRadialGradient(x,y,0, x,y, 18*DPR);
      tip.addColorStop(0,"rgba(255,180,180,.95)");
      tip.addColorStop(1,"rgba(220,38,38,0)");
      ctx.fillStyle = tip;
      ctx.beginPath();
      ctx.arc(x,y, 18*DPR, 0, Math.PI*2);
      ctx.fill();
    }

    // main stroke
    ctx.strokeStyle = "#ef4444";
    ctx.shadowColor = "rgba(239,68,68,.55)";
    ctx.shadowBlur = 18*DPR;
    ctx.lineWidth = Math.max(1, 4 * DPR);
    ctx.beginPath();
    for (let i=0;i<=Math.floor(2500*p);i++){
      const theta = 2*Math.PI*i/2500;
      const r = R * Math.cos(k*theta);
      const x = r * Math.cos(theta);
      const y = r * Math.sin(theta);
      if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
    ctx.stroke();
    ctx.restore();

    // caption
    ctx.fillStyle = "rgba(255,255,255,.75)";
    ctx.font = `${14*DPR}px -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif`;
    ctx.textAlign = "center";
    ctx.fillText(`r = aÂ·cos(${k}Î¸) â€¢ tap to restart`, w/2, h - 18*DPR);
  }

  function loop(ts) {
    if (!t0) t0 = ts;
    const elapsed = ts - t0;
    drawFrame(elapsed);
    if (elapsed < 10000 && running) animId = requestAnimationFrame(loop);
  }

  function start() {
    running = true;
    cancelAnimationFrame(animId);
    t0 = 0; animId = requestAnimationFrame(loop);
  }

  function restart() { start(); }

  // Webview quirks: pause/resume on visibility
  document.addEventListener("visibilitychange", () => {
    if (document.hidden) { running = false; cancelAnimationFrame(animId); }
    else { start(); }
  });

  // Tap handlers
  canvas.addEventListener("click", restart, {passive:true});
  restartBtn.addEventListener("click", restart);

  // Auto-start when DOM is ready (works in in-app browsers)
  if (document.readyState === "complete" || document.readyState === "interactive") start();
  else document.addEventListener("DOMContentLoaded", start);
})();
</script>
</body>
</html>
"""
path = "/mnt/data/rose_shareable.html"
with open(path, "w", encoding="utf-8") as f:
    f.write(html)
path
